# 🎨 WS2812 8x8 WiFi Pixel Matrix

**ESP32-C3 控制的全彩点阵像素画板**

这是一个基于 **ESP32-C3** 和 **WS2812B (8x8)** 全彩点阵屏的物联网像素画板项目。

本项目包含两部分：

1. **下位机 (Firmware)**: 基于 ESP-IDF 开发，负责驱动 LED、连接 WiFi、提供 HTTP API 接口以及显示系统状态动画。
2. **上位机 (Web Client)**: 基于 Node.js/Express 的 Web 界面，允许用户在浏览器中绘制像素画、调节颜色和亮度，并实时同步到点阵屏。

## ✨ 功能特性

### 🤖 下位机 (ESP32)

- **炫酷开机动画**: 包含中心放射扩散（雷达效果）和滚动文字欢迎语。
- **智能状态反馈**:
  - **连接中**: 黄色呼吸灯动画。
  - **连接成功**: 滚动显示设备 IP 地址，并在待机界面显示绿色对勾 ✅。
  - **连接超时**: 滚动显示 "TIMEOUT" 并显示红色叉号 ❌（支持自动重启重试）。
- **硬件适配**:
  - 内置蛇形走线（Snake Layout）坐标映射。
  - 内置左右镜像修正（Web 端左侧对应硬件左侧）。
  - WiFi 功率限制（防止 USB 供电不足导致掉电）。

### 💻 上位机 (Web 画板)

- 🎨 **实时绘图**: 支持鼠标左键点击/拖拽上色，右键擦除。
- 🌈 **全彩支持**: 自定义 RGB 颜色选择器。
- 💡 **亮度调节**: 支持 0-100% 全局亮度无损调节。
- 💾 **本地存储**: 可以将喜欢的图案保存到浏览器本地 (LocalStorage)，随时一键回放。
- 📱 **多端适配**: 支持手机和电脑在同一局域网下访问控制。

## 🛠️ 硬件准备

| **硬件名称**       | **描述**              | **备注**            |
| ------------------ | --------------------- | ------------------- |
| **ESP32-C3**       | 开发板 (如 SuperMini) | 任意 ESP32 系列均可 |
| **WS2812B Matrix** | 8x8 全彩 LED 点阵屏   | 64 位灯珠           |
| **杜邦线**         | 用于连接              | 3根 (5V, GND, IO)   |

### 接线说明

| **ESP32-C3 Pin** | **WS2812 Pin** | **说明**        |
| ---------------- | -------------- | --------------- |
| **5V**           | **5V / VCC**   | 供电 (注意功率) |
| **GND**          | **GND**        | 地线            |
| **GPIO 3**       | **DIN / IN**   | 数据信号输入    |

> **注意**: 代码中默认定义数据脚为 `GPIO 3`，如使用其他引脚请修改固件宏定义。

------

## 🚀 快速开始

### 1. 下位机 (ESP32 Firmware)

确保你已经安装了 [ESP-IDF v5.x](https://docs.espressif.com/projects/esp-idf/en/latest/esp32c3/get-started/index.html) 开发环境。

配置 WiFi:

打开 Train_led_wifi/main/blink_example_main.c，修改以下宏定义为你自己的 WiFi 信息：

C

```
#define WIFI_SSID      "你的WiFi名称"
#define WIFI_PASS      "你的WiFi密码"
#define LED_STRIP_GPIO 3  // 如果你的数据脚不是3，请修改这里
```

**编译与烧录:**

Bash

```
cd Train_led_wifi

# 设置目标芯片 (如果是第一次运行)
idf.py set-target esp32c3

# 编译、烧录并打开串口监视器
idf.py build flash monitor
```

**烧录成功后:**

- 观察点阵屏，它会显示开机动画。
- 等待 WiFi 连接成功，屏幕会滚动显示 **IP 地址** (例如 `192.168.1.100`)。请记下这个 IP。

### 2. 上位机 (Web Server)

确保你的电脑安装了 [Node.js](https://nodejs.org/)。

**安装依赖:**

Bash

```
cd 8x8_wifi_matrix_server
npm install
```

**启动服务:**

Bash

```
node app.js
```

**访问画板:**

- **本机访问**: 浏览器打开 `http://localhost:3000`
- **手机访问**: 确保手机和电脑在同一 WiFi 下，访问控制台打印出来的局域网地址 (例如 `http://192.168.1.5:3000`)。

------

## 📖 使用指南

1. 打开 Web 界面。
2. 在 **"ESP32 IP 地址"** 输入框中，填入点阵屏刚才显示的 IP 地址。
3. **选择颜色**: 点击颜色选择器挑选喜欢的色彩。
4. **绘图**:
   - 在网格上点击或拖动鼠标左键进行绘制。
   - 使用 **鼠标右键** 进行擦除。
5. **调节亮度**: 拖动下方的亮度滑块，调整到舒适的亮度（推荐 20% 左右）。
6. 点击 **"📡 发送图案"**，点阵屏将即时显示你的作品！
7. **保存作品**: 输入作品名称并点击保存，下次可以直接从列表加载。

## ⚙️ 常见问题 (FAQ)

Q: 为什么显示的图案是左右反的？

A: 不同的点阵屏硬件走线方向不同。目前的固件默认对 X 轴进行了镜像处理 (7-x)。

如果你的显示是反的，请修改 blink_example_main.c 中的 set_pixel_by_index 函数，将 matrix_set_pixel(7-x, ...) 改为 matrix_set_pixel(x, ...)。

Q: WiFi 一直连不上，显示红叉？

A:

1. 确认 WiFi 账号密码是否正确（注意大小写）。
2. ESP32-C3 仅支持 **2.4GHz WiFi**，不支持 5GHz。
3. 检查供电是否充足，或者尝试将 USB 线插在电脑后置接口。

Q: 亮度太高刺眼怎么办？

A: 可以在 Web 端拖动亮度条降低亮度。固件内部也做了最大功率限制，防止电流过载。

## 📂 项目结构

```
.
├── 8x8_wifi_matrix_server/  # 上位机 (Node.js)
│   ├── public/              # 前端静态文件 (HTML/CSS/JS)
│   ├── app.js               # 服务端入口
│   └── package.json
│
├── Train_led_wifi/          # 下位机 (ESP-IDF)
│   ├── main/
│   │   ├── blink_example_main.c # 核心逻辑代码
│   │   ├── font8x8.h            # 8x8 ASCII 字库
│   │   └── ...
│   ├── CMakeLists.txt
│   └── ...
└── README.md
```

## 👤 作者

**Center4maker  Maodie**

------

Happy Making! 🚀
